# @kirejs/auth Documentation for LLMs

## Overview
The Auth package provides authentication and authorization directives for Kire templates. It allows conditional rendering based on user login status and permissions.

## Configuration
When loading the plugin, you must provide `getUser` and `canPerm` callbacks.

```typescript
import { KireAuth } from '@kirejs/auth';

kire.plugin(KireAuth, {
    getUser: (ctx) => ctx.session.user, // Returns user object or null
    canPerm: (perm, user) => user?.permissions.includes(perm) // Boolean
});
```

## Directives

### Authentication Blocks
- **`@auth`**: Renders content if the user is logged in.
  - Supports `@else` block.
- **`@guest` / `@notlogged` / `@noauth`**: Renders content if the user is NOT logged in.
  - Supports `@else` block.
- **`@logged` / `@authenticated`**: Aliases for `@auth`.

**Example:**
```kire
@auth
    <p>Welcome, {{ user.name }}!</p>
@else
    <a href="/login">Please sign in</a>
@end
```

### Authorization (Permissions)
- **`@can(permission)`**: Renders if the user has the specified permission.
  - Supports `@else`.
- **`@notcan(permission)`**: Renders if the user DOES NOT have the permission.
- **`@canany(permissions_array)`**: Renders if the user has ANY of the provided permissions.

**Example:**
```kire
@can('edit_posts')
    <button>Edit Post</button>
@end

@canany(['admin', 'editor'])
    <p>You have management access.</p>
@end
```

### Context Helpers
- **`@user`**: Injects the current user object into the template scope as a variable named `user`.

**Example:**
```kire
@user
@if(user)
    <span>ID: {{ user.id }}</span>
@end
```
